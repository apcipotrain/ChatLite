# ChatLite

一个基于 **wxPython + MySQL** 的轻量级聊天系统。  
支持 **好友私聊、群聊、历史记录、未读消息管理**，附带图形界面和简单的启动脚本。

---

## 🚀 功能特点
- 用户系统：注册、登录、找回密码
- 好友管理与群聊管理
- 私聊消息（未读消息支持）
- 群聊消息（支持历史记录查询）
- 聊天界面消息左右分栏（自己在右，对方在左）
- 字体大小可自定义
- 退出登录功能
- 本地启动脚本：`Server.bat` 启动服务器，`ChatLite.bat` 启动客户端

---

## 📂 项目结构
1️⃣ users.py

用户管理模块

register：注册用户（用户名、密码、昵称、手机号）。

login：验证用户名+密码是否正确。

list_users：列出所有用户。

reset_password：根据用户名+手机号重置密码。

get_user：查询用户信息（支持用用户名或昵称）。

👉 功能定位：提供用户注册、登录、信息查询和安全管理的接口。

2️⃣ friends.py

好友关系管理模块

add_friend：双向添加好友。

remove_friend：双向删除好友。

get_friends：获取某个用户的好友列表。

👉 功能定位：维护用户之间的好友关系。

3️⃣ groups.py

群聊管理模块

create_group：创建群聊，自动把群主加入群成员表。

join_group：用户加入群聊。

list_groups：查询用户所在的所有群。

list_group_members：查看某个群的成员列表（群主会被标注）。

leave_group：用户退出群聊。

delete_group：群主解散群聊。

👉 功能定位：支持群聊的生命周期管理和成员维护。

4️⃣ messages.py

消息存储与查询模块

save_message：保存一条私聊消息。

get_messages：获取两人之间的私聊历史。

save_group_message：保存一条群聊消息。

get_group_messages：获取群聊历史。

get_unread_messages：获取用户未读的私聊消息（用于离线消息补发）。

mark_messages_read：标记用户的私聊消息为已读。

👉 功能定位：负责消息的落库、历史查询和未读状态管理。


1️⃣ client.py

命令行客户端

提供一个基于控制台的聊天入口（和 ui_chat.py 图形界面并行）。

主要功能：

登录验证

好友管理（添加、删除、查看）

群聊管理（创建、加入、退出、解散、查看成员）

切换私聊/群聊对象并发送消息

查看私聊/群聊历史记录

接收服务器转发的消息并打印

👉 功能定位：命令行版本的客户端，用于调试和简单测试。

2️⃣ server.py

服务器端

维护 online_users（当前在线用户字典）。

负责：

用户连接 / 下线管理

私聊消息转发（含离线消息入库 / 上线后推送）

群聊消息转发

群聊管理命令（创建、加入、退出、解散、查询）

离线私聊消息：使用数据库 is_read=0 标记，用户上线时推送，随后 mark_messages_read。

👉 功能定位：即时通信的核心消息中转站。

3️⃣ test_db.py

数据库测试脚本

用于验证 用户名 + 手机号，并支持修改密码。

可以单独运行来测试数据库读写。

👉 功能定位：数据库功能调试工具。

4️⃣ ui_actions.py

界面操作逻辑模块

定义了多个按钮/菜单的操作行为：

on_info：查看聊天对象详情（好友 → 删除/查询历史；群聊 → 成员/解散/退出/查询历史）。

show_history：展示好友或群聊的历史记录（带自动滚动）。

on_friend_mgmt：好友管理（添加好友）。

on_group_mgmt：群聊管理（加入/创建）。

on_history：左下角“历史记录”按钮入口（手动输入名字查询）。

👉 功能定位：UI 和数据库/逻辑层之间的桥梁，把按钮事件映射到实际操作。

5️⃣ ui_auth.py

认证界面模块

登录、注册、找回密码的三个窗口：

LoginFrame：登录框（支持跳转注册/找回密码）。

RegisterFrame：注册框。

PasswordResetFrame：找回密码框（用户名 + 手机号验证 + 重设密码）。

👉 功能定位：系统的入口 UI，负责用户身份管理。

6️⃣ ui_chat.py

聊天主界面

核心窗口 ChatFrame：

左侧：好友树 / 群聊树、未读消息列表、功能菜单（好友管理、群聊管理、历史记录）、退出登录、设置按钮。

右侧：顶部栏（TopBar）、消息显示区、输入框、发送按钮。

功能：

聊天气泡左右显示（区分自己和对方）。

未读消息管理（支持点击查看、标记已读/未读）。

离线消息上线后推送。

历史消息展示（滚动到底）。

设置窗口（选择字体/字号）。

退出登录（确认弹窗，返回登录界面）。

👉 功能定位：即时通信的主要界面，所有功能的核心承载。

7️⃣ ui_main.py

程序主入口

类 MainApp(wx.App)：

show_login → 显示登录界面

show_register → 显示注册界面

show_reset → 显示找回密码界面

show_chat → 显示聊天主界面

👉 功能定位：全局窗口控制器，负责不同窗口之间的切换。

8️⃣ ui_topbar.py

聊天窗口顶部栏

包含聊天对象标题（左） + “详情/返回/标记未读”等按钮（右）。

提供 set_label、set_button_label 方法更新显示内容。

👉 功能定位：聊天窗口的辅助 UI 组件，提升用户交互体验。

✅ 总结（和 db 文件夹联动）

db/ → 纯数据层（用户、好友、群聊、消息）。

server.py → 服务端逻辑层（转发、存储、推送）。

client.py / ui_chat.py → 客户端层（命令行 / GUI）。

ui_auth.py / ui_main.py → 登录/注册与全局入口。

ui_actions.py / ui_topbar.py → 界面操作逻辑和组件。

test_db.py → 调试工具。
